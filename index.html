<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Web Vision Pro - Smooth & Scroll</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

    <style>
        * { box-sizing: border-box; user-select: none; -webkit-user-select: none; }
        body {
            margin: 0; padding: 0;
            background: #000;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
            overflow: hidden;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            /* æ›´æ·±é‚ƒçš„ç©ºé—´èƒŒæ™¯ */
            background: radial-gradient(circle at 50% 50%, #3a3a3a 0%, #111 60%, #000 100%);
        }

        .input_video { display: none; }

        /* å¯åŠ¨æŒ‰é’® */
        #start-btn {
            position: absolute; z-index: 1000;
            padding: 16px 32px;
            background: rgba(255, 255, 255, 0.9);
            color: #000;
            border-radius: 50px;
            font-size: 18px; font-weight: 600;
            border: none; cursor: pointer;
            box-shadow: 0 0 20px rgba(255,255,255,0.3);
            transition: transform 0.2s;
        }
        #start-btn:active { transform: scale(0.95); }

        /* åº”ç”¨ç½‘æ ¼ */
        .app-grid {
            display: flex; gap: 50px; z-index: 10;
            transition: opacity 0.3s, transform 0.3s;
            perspective: 1000px; /* å¢åŠ é€è§†æ„Ÿ */
        }

        /* 3D ç»ç’ƒæ‹Ÿæ€å›¾æ ‡ */
        .app-icon {
            width: 110px; height: 110px;
            /* æ ¸å¿ƒç»ç’ƒè´¨æ„Ÿ */
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(25px) saturate(180%);
            -webkit-backdrop-filter: blur(25px) saturate(180%);
            border-radius: 28px;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            color: white;
            /* 3D è¾¹ç¼˜å…‰æ•ˆå’Œåšåº¦æ„Ÿ */
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-bottom: 3px solid rgba(255, 255, 255, 0.1); /* åšåº¦æ¨¡æ‹Ÿ */
            box-shadow: 
                0 15px 35px rgba(0,0,0,0.5), /* æŠ•å½± */
                inset 0 0 0 1px rgba(255,255,255,0.1); /* å†…å‘å…‰ */
            transition: all 0.15s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .app-icon.hovered {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.15) translateY(-10px); /* æ‚¬åœä¸Šæµ® */
            box-shadow: 
                0 25px 50px rgba(0,0,0,0.6),
                inset 0 0 20px rgba(255,255,255,0.2);
            border-color: rgba(255, 255, 255, 0.8);
        }
        
        .app-icon:active {
            transform: scale(0.95); /* ç‚¹å‡»ä¸‹æ²‰ */
        }

        .icon-img { font-size: 38px; margin-bottom: 8px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3)); }
        .app-icon span { font-size: 13px; font-weight: 500; letter-spacing: 0.5px; opacity: 0.9; }

        /* è™šæ‹Ÿå…‰æ ‡ - æ›´å°æ›´äº® */
        #cursor {
            position: fixed; top: 0; left: 0;
            width: 20px; height: 20px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            pointer-events: none;
            transform: translate(-50%, -50%);
            z-index: 999;
            box-shadow: 0 0 15px rgba(255,255,255,0.6);
            transition: width 0.15s, height 0.15s, background 0.15s;
            mix-blend-mode: difference; /* æ™ºèƒ½åè‰²ï¼Œä¿è¯åœ¨äº®èƒŒæ™¯ä¹Ÿèƒ½çœ‹è§ */
        }
        #cursor.clicking {
            width: 12px; height: 12px;
            background: #00ff00; /* ç‚¹å‡»åé¦ˆå˜ç»¿ */
            box-shadow: 0 0 20px #00ff00;
        }

        /* çª—å£é€šç”¨æ ·å¼ */
        .window {
            position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 90%; max-width: 420px; height: 500px;
            background: rgba(20, 20, 20, 0.85);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 30px 80px rgba(0,0,0,0.8);
            display: none; flex-direction: column;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 100;
            padding: 20px;
            color: #fff;
        }
        .window.open { display: flex; opacity: 1; transform: translate(-50%, -50%) scale(1); }
        
        .window-header {
            display: flex; justify-content: space-between; align-items: center;
            padding-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 10px;
        }
        .window-title { font-size: 20px; font-weight: 600; }

        /* æ»šåŠ¨å®¹å™¨ */
        .scroll-container {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            mask-image: linear-gradient(to bottom, transparent, black 10%, black 90%, transparent);
            -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 5%, black 95%, transparent 100%);
            padding: 10px 0;
        }
        
        /* æ»šåŠ¨æ¡éšè—ä½†ä¿ç•™åŠŸèƒ½ */
        .scroll-container::-webkit-scrollbar { width: 4px; }
        .scroll-container::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 4px; }

        /* è®¾ç½®é¡¹åˆ—è¡¨ */
        .setting-item {
            padding: 15px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            font-size: 16px;
            display: flex; align-items: center;
            border: 1px solid transparent;
            transition: background 0.2s;
        }
        .setting-item.hovered { background: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255,255,255,0.3); }

        .close-btn {
            margin-top: 15px; padding: 12px;
            background: rgba(60, 60, 60, 0.8);
            color: white; border: none; border-radius: 25px;
            font-weight: 600; cursor: pointer; width: 100%;
            transition: background 0.2s;
        }
        .close-btn.hovered { background: #fff; color: #000; }

        #status { position: absolute; bottom: 20px; color: rgba(255,255,255,0.3); font-size: 12px; pointer-events: none;}
    </style>
</head>
<body>

    <video class="input_video" playsinline></video>
    <button id="start-btn">è¿›å…¥ç©ºé—´</button>
    <div id="cursor"></div>

    <!-- ä¸»èœå• -->
    <div class="app-grid" id="main-menu">
        <div class="app-icon" id="app-settings">
            <div class="icon-img">âš™ï¸</div>
            <span>è®¾ç½®</span>
        </div>
        <div class="app-icon" id="app-hello">
            <div class="icon-img">ğŸŒ</div>
            <span>æ¢ç´¢</span>
        </div>
    </div>

    <!-- è®¾ç½®çª—å£ -->
    <div class="window" id="window-settings">
        <div class="window-header">
            <span class="window-title">ç³»ç»Ÿè®¾ç½®</span>
            <span>ğŸ”‹ 100%</span>
        </div>
        <!-- å¯æ»šåŠ¨åŒºåŸŸ -->
        <div class="scroll-container" id="settings-scroll">
            <div class="setting-item">ğŸ“¶ æ— çº¿å±€åŸŸç½‘</div>
            <div class="setting-item">ğŸ”µ è“ç‰™</div>
            <div class="setting-item">ğŸ¨ æ˜¾ç¤ºä¸äº®åº¦</div>
            <div class="setting-item">ğŸ”Š å£°éŸ³ä¸è§¦æ„Ÿ</div>
            <div class="setting-item">ğŸ”’ é¢å®¹ ID ä¸å¯†ç </div>
            <div class="setting-item">ğŸŒ™ ä¸“æ³¨æ¨¡å¼</div>
            <div class="setting-item">â³ å±å¹•ä½¿ç”¨æ—¶é—´</div>
            <div class="setting-item">âš™ï¸ é€šç”¨</div>
            <div class="setting-item">â˜ï¸ iCloud</div>
            <div class="setting-item">ğŸµ éŸ³ä¹</div>
            <div class="setting-item">ğŸ“· ç›¸æœº</div>
            <div class="setting-item">ğŸ–¼ï¸ ç…§ç‰‡</div>
        </div>
        <button class="close-btn" id="close-settings">å…³é—­çª—å£</button>
    </div>

    <!-- Hello çª—å£ -->
    <div class="window" id="window-hello">
        <div class="window-header">
            <span class="window-title">Hello World</span>
        </div>
        <div style="flex:1; display:flex; align-items:center; justify-content:center; text-align:center;">
            <p style="font-size: 18px; line-height: 1.6;">æ¬¢è¿ä½“éªŒ<br>Web Vision OS<br><br>ğŸ‘ˆ å°è¯•æä½æ»šåŠ¨å·¦è¾¹çš„åˆ—è¡¨</p>
        </div>
        <button class="close-btn" id="close-hello">å…³é—­çª—å£</button>
    </div>

    <div id="status">ç­‰å¾…ç›¸æœºæƒé™...</div>

    <script>
        const cursor = document.getElementById('cursor');
        const startBtn = document.getElementById('start-btn');
        const statusText = document.getElementById('status');
        
        // çŠ¶æ€å˜é‡
        let cursorX = window.innerWidth / 2, cursorY = window.innerHeight / 2;
        let targetX = window.innerWidth / 2, targetY = window.innerHeight / 2;
        let isPinching = false;
        let isDragging = false;
        
        // æ»šåŠ¨é€»è¾‘å˜é‡
        let dragStartY = 0;
        let activeScrollElement = null;
        let initialScrollTop = 0;

        // é…ç½®å‚æ•°
        const LERP_SPEED = 0.45; // æé«˜è·Ÿæ‰‹é€Ÿåº¦ (ä¹‹å‰æ˜¯0.2)
        const PINCH_THRESHOLD = 0.06; // æåˆçµæ•åº¦
        
        // MediaPipe åˆå§‹åŒ–
        const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
        hands.setOptions({
            maxNumHands: 1,
            modelComplexity: 1,
            minDetectionConfidence: 0.6, // é™ä½ä¸€ç‚¹ç½®ä¿¡åº¦è¦æ±‚ä»¥æé«˜å“åº”é€Ÿåº¦
            minTrackingConfidence: 0.6
        });
        hands.onResults(onResults);

        // æ‘„åƒå¤´
        const camera = new Camera(document.querySelector('.input_video'), {
            onFrame: async () => { await hands.send({image: document.querySelector('.input_video')}); },
            width: 640, height: 480, facingMode: "user"
        });

        startBtn.addEventListener('click', () => {
            startBtn.style.display = 'none';
            statusText.innerText = "å¯åŠ¨ä¸­...";
            camera.start().then(() => statusText.innerText = "å‡†å¤‡å°±ç»ª").catch(e => statusText.innerText = "å¤±è´¥:"+e);
        });

        function onResults(results) {
            if (!results.multiHandLandmarks?.length) return;

            const landmarks = results.multiHandLandmarks[0];
            const indexTip = landmarks[8];
            const thumbTip = landmarks[4];

            // 1. ä¼˜åŒ–åçš„å…‰æ ‡ç§»åŠ¨ (å¢åŠ é€Ÿåº¦å€ç‡)
            // å°†æ‰‹éƒ¨ç§»åŠ¨èŒƒå›´æ˜ å°„æ”¾å¤§ï¼Œè¿™æ ·æ‰‹ä¸ç”¨åŠ¨å¤ªå¤šï¼Œå…‰æ ‡å°±èƒ½å…¨å±è·‘
            const sensitivity = 1.3; // ç§»åŠ¨å¢ç›Š
            let rawX = (1 - indexTip.x) * window.innerWidth;
            let rawY = indexTip.y * window.innerHeight;
            
            // ç®€å•çš„ä¸­å¿ƒç‚¹åç§»æ ¡æ­£ï¼Œè®©æ‰‹åœ¨å±å¹•ä¸­å¤®æ—¶å…‰æ ‡ä¹Ÿåœ¨ä¸­å¤®
            rawX = (rawX - window.innerWidth/2) * sensitivity + window.innerWidth/2;
            rawY = (rawY - window.innerHeight/2) * sensitivity + window.innerHeight/2;

            // é™åˆ¶å…‰æ ‡ä¸å‡ºå±å¹•
            rawX = Math.max(0, Math.min(window.innerWidth, rawX));
            rawY = Math.max(0, Math.min(window.innerHeight, rawY));

            // é«˜é€Ÿæ’å€¼
            cursorX += (rawX - cursorX) * LERP_SPEED;
            cursorY += (rawY - cursorY) * LERP_SPEED;

            cursor.style.left = `${cursorX}px`;
            cursor.style.top = `${cursorY}px`;

            // 2. æåˆæ£€æµ‹
            const distance = Math.sqrt(Math.pow(indexTip.x - thumbTip.x, 2) + Math.pow(indexTip.y - thumbTip.y, 2));
            const currentlyPinching = distance < PINCH_THRESHOLD;

            // 3. äº¤äº’çŠ¶æ€æœº
            if (currentlyPinching) {
                if (!isPinching) {
                    // === åˆšå¼€å§‹æåˆ (Touch Start) ===
                    isPinching = true;
                    cursor.classList.add('clicking');
                    
                    // æ£€æŸ¥æ˜¯å¦åœ¨å¯æ»šåŠ¨ç‰©ä½“ä¸Š
                    const elementBelow = document.elementFromPoint(cursorX, cursorY);
                    // å‘ä¸ŠæŸ¥æ‰¾æœ€è¿‘çš„ scroll-container
                    const scrollable = elementBelow?.closest('.scroll-container');
                    
                    if (scrollable) {
                        isDragging = true;
                        activeScrollElement = scrollable;
                        dragStartY = cursorY; // è®°å½•æåˆæ—¶çš„å…‰æ ‡Yä½ç½®
                        initialScrollTop = scrollable.scrollTop;
                    } else {
                        // æ™®é€šç‚¹å‡»è§¦å‘
                        handleTap(cursorX, cursorY);
                    }
                } else {
                    // === ä¿æŒæåˆ (Touch Move / Drag) ===
                    if (isDragging && activeScrollElement) {
                        // è®¡ç®—å‚ç›´ç§»åŠ¨è·ç¦»
                        const deltaY = cursorY - dragStartY;
                        // æ›´æ–°æ»šåŠ¨æ¡ (ä¹˜ä»¥ç³»æ•°è®©æ»šåŠ¨æ›´è·Ÿæ‰‹ï¼Œè´Ÿå·æ˜¯å› ä¸ºå‘ä¸Šç§»è¦å‘ä¸‹æ»š)
                        activeScrollElement.scrollTop = initialScrollTop - (deltaY * 2.5);
                    }
                }
            } else {
                if (isPinching) {
                    // === æ¾å¼€æåˆ (Touch End) ===
                    isPinching = false;
                    isDragging = false;
                    activeScrollElement = null;
                    cursor.classList.remove('clicking');
                }
            }

            // 4. æ‚¬åœæ•ˆæœ (åªåœ¨éæ‹–æ‹½æ—¶è§¦å‘)
            if (!isDragging) {
                handleHover(cursorX, cursorY);
            }
        }

        function handleHover(x, y) {
            // æ¸…ç†æ—§çš„
            document.querySelectorAll('.hovered').forEach(el => el.classList.remove('hovered'));
            // æ·»åŠ æ–°çš„
            const el = document.elementFromPoint(x, y);
            if (!el) return;
            
            // æ”¯æŒå›¾æ ‡ã€æŒ‰é’®ã€åˆ—è¡¨é¡¹çš„æ‚¬åœ
            const target = el.closest('.app-icon, .close-btn, .setting-item');
            if (target) target.classList.add('hovered');
        }

        function handleTap(x, y) {
            const el = document.elementFromPoint(x, y);
            if (!el) return;

            // æ‰“å¼€åº”ç”¨
            if (el.closest('#app-settings')) openWindow('window-settings');
            if (el.closest('#app-hello')) openWindow('window-hello');
            
            // å…³é—­æŒ‰é’®
            if (el.closest('.close-btn')) closeAllWindows();
        }

        function openWindow(id) {
            document.getElementById('main-menu').style.opacity = '0';
            document.getElementById('main-menu').style.pointerEvents = 'none';
            setTimeout(() => {
                const win = document.getElementById(id);
                win.classList.add('open');
            }, 200);
        }

        function closeAllWindows() {
            document.querySelectorAll('.window').forEach(w => w.classList.remove('open'));
            setTimeout(() => {
                const menu = document.getElementById('main-menu');
                menu.style.opacity = '1';
                menu.style.pointerEvents = 'all';
            }, 200);
        }
    </script>
</body>
</html>