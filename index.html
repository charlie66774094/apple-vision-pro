<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Web Vision Pro - Browser Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

    <style>
        /* === æ ¸å¿ƒåŸºç¡€æ ·å¼ === */
        * { box-sizing: border-box; user-select: none; -webkit-user-select: none; }
        body {
            margin: 0; padding: 0;
            background: #000;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
            overflow: hidden;
            height: 100dvh;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: radial-gradient(circle at 50% 50%, #1a1a1a 0%, #000 100%);
        }

        .input_video { display: none; }

        /* å¯åŠ¨æŒ‰é’® */
        #start-btn {
            position: absolute; z-index: 1000;
            padding: 16px 32px; background: rgba(255,255,255,0.9); color: black;
            border-radius: 50px; font-size: 18px; font-weight: 600;
            border: none; cursor: pointer;
            box-shadow: 0 0 25px rgba(255,255,255,0.2);
            transition: transform 0.2s;
        }
        #start-btn:active { transform: scale(0.95); }

        /* è™šæ‹Ÿå…‰æ ‡ */
        #cursor {
            position: fixed; top: 0; left: 0;
            width: 20px; height: 20px;
            background: rgba(255, 255, 255, 0.85);
            border-radius: 50%;
            pointer-events: none;
            transform: translate(-50%, -50%);
            z-index: 999;
            box-shadow: 0 0 15px rgba(255,255,255,0.5);
            transition: width 0.15s, height 0.15s, opacity 0.2s;
            mix-blend-mode: difference;
        }
        #cursor.hidden { opacity: 0; }
        #cursor.clicking { width: 12px; height: 12px; background: #32d74b; }

        /* æ—¶é—´å°çª— (æ‰‹èƒŒè§¦å‘) */
        #time-widget {
            position: fixed; top: 0; left: 0;
            width: 130px; height: 50px;
            background: rgba(60, 60, 60, 0.7);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-radius: 25px; border: 1px solid rgba(255,255,255,0.2);
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: 600; font-size: 20px;
            z-index: 998; pointer-events: none; opacity: 0;
            transform: translate(-50%, -50%) scale(0.8);
            transition: opacity 0.3s, transform 0.3s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        #time-widget.show { opacity: 1; transform: translate(-50%, -50%) scale(1); }

        /* === åº”ç”¨ç½‘æ ¼ === */
        .app-grid { display: flex; gap: 40px; transition: opacity 0.3s; perspective: 1000px; }
        
        .app-icon {
            width: 100px; height: 100px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            border-radius: 24px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: white; 
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-bottom: 3px solid rgba(255,255,255,0.1);
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            transition: all 0.2s;
        }
        
        /* ä¸åŒçš„å›¾æ ‡èƒŒæ™¯è‰²å¾®è°ƒ */
        #app-browser { background: linear-gradient(135deg, rgba(52, 199, 249, 0.3), rgba(0, 122, 255, 0.3)); }
        #app-settings { background: linear-gradient(135deg, rgba(142, 142, 147, 0.3), rgba(99, 99, 102, 0.3)); }
        #app-hello { background: linear-gradient(135deg, rgba(255, 149, 0, 0.3), rgba(255, 59, 48, 0.3)); }

        .app-icon.hovered {
            transform: scale(1.15) translateY(-10px);
            border-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 25px 50px rgba(0,0,0,0.7);
        }
        .icon-img { font-size: 36px; margin-bottom: 5px; filter: drop-shadow(0 4px 4px rgba(0,0,0,0.3));}
        .app-icon span { font-size: 12px; font-weight: 500; opacity: 0.9; }

        /* === çª—å£é€šç”¨ === */
        .window {
            position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 90%; max-width: 440px; height: 550px;
            background: rgba(30, 30, 30, 0.9);
            backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);
            border-radius: 24px; border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 40px 100px rgba(0,0,0,0.8);
            display: none; flex-direction: column; opacity: 0;
            transition: opacity 0.3s, transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            z-index: 100; overflow: hidden;
        }
        .window.open { display: flex; opacity: 1; transform: translate(-50%, -50%) scale(1); }

        /* çª—å£é¡¶éƒ¨æ  */
        .window-bar {
            height: 44px; display: flex; align-items: center; justify-content: center;
            border-bottom: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05);
            font-weight: 600; color: #fff; position: relative;
        }
        .url-bar {
            background: rgba(0,0,0,0.2); padding: 4px 12px; border-radius: 8px;
            font-size: 12px; color: #aaa; width: 60%; text-align: center;
            display: flex; align-items: center; justify-content: center; gap: 5px;
        }

        /* æ»šåŠ¨å†…å®¹åŒºåŸŸ */
        .scroll-container { flex: 1; overflow-y: auto; padding: 0; position: relative; }
        
        /* è®¾ç½®é¡¹æ ·å¼ */
        .settings-content { padding: 10px; }
        .setting-item { padding: 16px; margin: 8px 0; background: rgba(255,255,255,0.08); border-radius: 12px; color: #fff;}
        .setting-item.hovered { background: rgba(255,255,255,0.2); }

        /* æµè§ˆå™¨æ¨¡æ‹Ÿå†…å®¹ */
        .browser-content { padding: 15px; color: #ddd; }
        .search-result { margin-bottom: 25px; padding: 10px; border-radius: 8px; }
        .search-result.hovered { background: rgba(255,255,255,0.05); }
        .res-title { color: #64d2ff; font-size: 18px; margin-bottom: 4px; display: block; text-decoration: none;}
        .res-url { color: #aaa; font-size: 12px; margin-bottom: 4px; }
        .res-desc { color: #ccc; font-size: 14px; line-height: 1.4; }

        /* å…³é—­æŒ‰é’®åŒºåŸŸ */
        .window-footer { padding: 15px; border-top: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.2); }
        .close-btn { 
            width: 100%; padding: 12px; background: rgba(60,60,60,0.8); 
            color: white; border: none; border-radius: 12px; font-weight: 600; 
        }
        .close-btn.hovered { background: #fff; color: #000; }

        #status { position: absolute; bottom: 20px; color: rgba(255,255,255,0.3); font-size: 12px; pointer-events: none;}
    </style>
</head>
<body>

    <video class="input_video" playsinline></video>
    <button id="start-btn">å¼€å¯ç©ºé—´</button>
    <div id="cursor"></div>
    <div id="time-widget"><span id="clock-text">12:00</span></div>

    <!-- ä¸»èœå• -->
    <div class="app-grid" id="main-menu">
        <div class="app-icon" id="app-browser">
            <div class="icon-img">ğŸ§­</div><span>æµè§ˆå™¨</span>
        </div>
        <div class="app-icon" id="app-settings">
            <div class="icon-img">âš™ï¸</div><span>è®¾ç½®</span>
        </div>
        <div class="app-icon" id="app-hello">
            <div class="icon-img">ğŸª</div><span>ä¸–ç•Œ</span>
        </div>
    </div>

    <!-- æµè§ˆå™¨çª—å£ -->
    <div class="window" id="window-browser">
        <div class="window-bar">
            <div class="url-bar">ğŸ”’ apple.com/vision-pro</div>
        </div>
        <div class="scroll-container browser-content">
            <div style="text-align:center; margin: 20px 0;">
                <h1 style="font-size:32px; margin-bottom:10px;">Google</h1>
                <div style="background:white; height:40px; border-radius:20px; width:80%; margin:0 auto; display:flex; align-items:center; padding-left:15px; color:#333;">Vision Pro</div>
            </div>
            
            <!-- æ¨¡æ‹Ÿæœç´¢ç»“æœ (çº¯DIVï¼Œç¦æ­¢è·³è½¬) -->
            <div class="search-result">
                <div class="res-url">https://www.apple.com.cn â€º vision-pro</div>
                <div class="res-title">Apple Vision Pro - Apple (ä¸­å›½å¤§é™†)</div>
                <div class="res-desc">æ¬¢è¿æ¥åˆ°ç©ºé—´è®¡ç®—æ—¶ä»£ã€‚Apple Vision Pro å°†æ•°å­—å†…å®¹æ— ç¼èå…¥ä½ çš„å®ä½“ç©ºé—´ï¼Œè®©ä½ èƒ½åšä»æœªåšè¿‡çš„äº‹ã€‚</div>
            </div>

            <div class="search-result">
                <div class="res-url">https://en.wikipedia.org â€º wiki â€º Vision_Pro</div>
                <div class="res-title">Apple Vision Pro - Wikipedia</div>
                <div class="res-desc">The Apple Vision Pro is a mixed-reality headset developed by Apple Inc. It was announced on June 5, 2023.</div>
            </div>

            <div class="search-result">
                <div class="res-url">https://www.theverge.com â€º reviews</div>
                <div class="res-title">Apple Vision Pro review: magic, until it's not</div>
                <div class="res-desc">The Vision Pro is an astounding product. It is the best consumer headset anyone has ever made.</div>
            </div>
            
             <div class="search-result">
                <div class="res-url">https://www.youtube.com â€º watch</div>
                <div class="res-title">Using Apple Vision Pro: What It's Actually Like!</div>
                <div class="res-desc">MKBHD gives his full thoughts on using the headset for 2 weeks straight. The pros, the cons, and the weight.</div>
            </div>
            
            <div style="height: 100px;"></div>
        </div>
        <div class="window-footer">
            <button class="close-btn">å…³é—­æµè§ˆå™¨</button>
        </div>
    </div>

    <!-- è®¾ç½®çª—å£ -->
    <div class="window" id="window-settings">
        <div class="window-bar">è®¾ç½®</div>
        <div class="scroll-container settings-content">
            <div class="setting-item">âœˆï¸ é£è¡Œæ¨¡å¼</div>
            <div class="setting-item">ğŸ“¡ æ— çº¿å±€åŸŸç½‘</div>
            <div class="setting-item">ğŸ¦· è“ç‰™</div>
            <div class="setting-item">ğŸ“± èœ‚çªç½‘ç»œ</div>
            <div class="setting-item">ğŸ”” é€šçŸ¥</div>
            <div class="setting-item">ğŸ”Š å£°éŸ³ä¸è§¦æ„Ÿ</div>
            <div class="setting-item">ğŸŒ™ ä¸“æ³¨æ¨¡å¼</div>
            <div class="setting-item">â³ å±å¹•ä½¿ç”¨æ—¶é—´</div>
            <div class="setting-item">âš™ï¸ é€šç”¨</div>
            <div class="setting-item">ğŸ•¹ï¸ æ§åˆ¶ä¸­å¿ƒ</div>
            <div style="height: 50px;"></div>
        </div>
        <div class="window-footer">
            <button class="close-btn">å…³é—­è®¾ç½®</button>
        </div>
    </div>

    <!-- Hello çª—å£ -->
    <div class="window" id="window-hello">
        <div class="window-bar">Hello</div>
        <div style="flex:1; display:flex; align-items:center; justify-content:center; flex-direction:column; text-align:center; padding:20px;">
            <h1>ğŸ‘‹</h1>
            <h2>Hello World</h2>
            <p style="color:#aaa; line-height:1.6;">ç¿»è½¬æ‰‹èƒŒæŸ¥çœ‹æ—¶é—´<br>æåˆæ‰‹æŒ‡è¿›è¡Œç‚¹å‡»<br>æŒ‰ä½å¹¶æ‹–åŠ¨è¿›è¡Œæ»šåŠ¨</p>
        </div>
        <div class="window-footer">
            <button class="close-btn">å…³é—­</button>
        </div>
    </div>

    <div id="status">ç­‰å¾…ç›¸æœºæˆæƒ...</div>

    <script>
        const cursor = document.getElementById('cursor');
        const timeWidget = document.getElementById('time-widget');
        const clockText = document.getElementById('clock-text');
        
        let cursorX = window.innerWidth/2, cursorY = window.innerHeight/2;
        let isPinching = false, isDragging = false;
        let activeScrollElement = null, dragStartY = 0, initialScrollTop = 0;
        let currentWidgetX = 0, currentWidgetY = 0;

        const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
        hands.setOptions({
            maxNumHands: 1,
            modelComplexity: 1,
            minDetectionConfidence: 0.6,
            minTrackingConfidence: 0.6
        });
        hands.onResults(onResults);

        const camera = new Camera(document.querySelector('.input_video'), {
            onFrame: async () => { await hands.send({image: document.querySelector('.input_video')}); },
            width: 640, height: 480, facingMode: "user"
        });

        document.getElementById('start-btn').addEventListener('click', function() {
            this.style.display = 'none';
            document.getElementById('status').innerText = "ç³»ç»Ÿå¯åŠ¨ä¸­...";
            camera.start();
        });

        function onResults(results) {
            if (!results.multiHandLandmarks?.length) {
                cursor.classList.add('hidden');
                timeWidget.classList.remove('show');
                return;
            }

            const landmarks = results.multiHandLandmarks[0];
            const p0 = landmarks[0];
            const p5 = landmarks[5];
            const p17 = landmarks[17];

            // === æ‰‹åŠ¿ç¿»è½¬é€»è¾‘ (å·²å›ºå®šä¸ºç”¨æˆ·è¦æ±‚çš„ç‰ˆæœ¬) ===
            // è®¡ç®— 2D å‰ç§¯ (Cross Product)
            // å…¬å¼: (x5 - x0)*(y17 - y0) - (y5 - y0)*(x17 - x0)
            const val = (p5.x - p0.x) * (p17.y - p0.y) - (p5.y - p0.y) * (p17.x - p0.x);

            // ã€æ³¨ã€‘ï¼šæ ¹æ®ç”¨æˆ·åé¦ˆï¼Œæ­¤å¤„é€»è¾‘å·²ä¿®æ­£ã€‚
            // ä¹‹å‰çš„é€»è¾‘ï¼šLeftæ¨¡å¼ä¸‹ val < 0 æ˜¯æ‰‹èƒŒ
            // ç°åœ¨çš„é€»è¾‘ï¼šç›´æ¥ä½¿ç”¨ Left Handedness çš„ä¿®æ­£ç‰ˆã€‚
            // å½“ val < 0 æ—¶ï¼Œè§†ä¸ºâ€œæ‰‹èƒŒâ€ (Back of Hand)
            // å½“ val > 0 æ—¶ï¼Œè§†ä¸ºâ€œæ‰‹å¿ƒâ€ (Palm)
            // å¢åŠ  0.01 çš„é˜ˆå€¼é˜²æ­¢é—ªçƒ
            
            const isBack = val > 0.01; 

            if (isBack) {
                // === æ‰‹èƒŒæ¨¡å¼ï¼šæ˜¾ç¤ºæ—¶é—´ ===
                cursor.classList.add('hidden');
                
                const now = new Date();
                clockText.innerText = now.getHours().toString().padStart(2,'0') + ":" + now.getMinutes().toString().padStart(2,'0');

                // ä½ç½®è·Ÿéšæ‰‹èƒŒä¸­å¿ƒ (Landmark 9)
                const middleFinger = landmarks[9];
                let tx = (1 - middleFinger.x) * window.innerWidth;
                let ty = middleFinger.y * window.innerHeight - 80;

                // ç®€å•çš„ä½ç½®å¹³æ»‘
                currentWidgetX += (tx - currentWidgetX) * 0.15;
                currentWidgetY += (ty - currentWidgetY) * 0.15;

                timeWidget.style.left = `${currentWidgetX}px`;
                timeWidget.style.top = `${currentWidgetY}px`;
                timeWidget.classList.add('show');

            } else {
                // === æ‰‹å¿ƒæ¨¡å¼ï¼šå…‰æ ‡æ“ä½œ ===
                timeWidget.classList.remove('show');
                cursor.classList.remove('hidden');

                const indexTip = landmarks[8];
                const thumbTip = landmarks[4];

                // å…‰æ ‡æ˜ å°„ä¸å¹³æ»‘
                const sensitivity = 1.4;
                let rx = (1 - indexTip.x) * window.innerWidth;
                let ry = indexTip.y * window.innerHeight;
                rx = (rx - window.innerWidth/2)*sensitivity + window.innerWidth/2;
                ry = (ry - window.innerHeight/2)*sensitivity + window.innerHeight/2;
                
                cursorX += (rx - cursorX) * 0.45;
                cursorY += (ry - cursorY) * 0.45;
                cursor.style.left = `${cursorX}px`;
                cursor.style.top = `${cursorY}px`;

                // æåˆæ£€æµ‹
                const dist = Math.hypot(indexTip.x - thumbTip.x, indexTip.y - thumbTip.y);
                const isPinchNow = dist < 0.06;

                if (isPinchNow) {
                    if (!isPinching) {
                        // === æåˆå¼€å§‹ ===
                        isPinching = true;
                        cursor.classList.add('clicking');
                        
                        const el = document.elementFromPoint(cursorX, cursorY);
                        // æŸ¥æ‰¾æœ€è¿‘çš„å¯æ»šåŠ¨åŒºåŸŸ
                        const scrollable = el?.closest('.scroll-container');
                        
                        if (scrollable) {
                            // è¿›å…¥æ‹–æ‹½æ»šåŠ¨æ¨¡å¼
                            isDragging = true;
                            activeScrollElement = scrollable;
                            dragStartY = cursorY;
                            initialScrollTop = scrollable.scrollTop;
                        } else {
                            // æ™®é€šç‚¹å‡»
                            handleTap(cursorX, cursorY);
                        }
                    } else if (isDragging && activeScrollElement) {
                        // === æ‹–æ‹½æ»šåŠ¨ä¸­ ===
                        const dy = cursorY - dragStartY;
                        // 2.5å€ç³»æ•°è®©æ»šåŠ¨æ›´è½»æ¾
                        activeScrollElement.scrollTop = initialScrollTop - dy * 2.5;
                    }
                } else {
                    // === æåˆé‡Šæ”¾ ===
                    isPinching = false;
                    isDragging = false;
                    cursor.classList.remove('clicking');
                }

                if (!isDragging) handleHover(cursorX, cursorY);
            }
        }

        // æ‚¬åœé«˜äº®é€»è¾‘
        function handleHover(x, y) {
            document.querySelectorAll('.hovered').forEach(el => el.classList.remove('hovered'));
            const el = document.elementFromPoint(x, y);
            
            // æ”¯æŒçš„åº”ç”¨å›¾æ ‡ã€å…³é—­æŒ‰é’®ã€è®¾ç½®é¡¹ã€æœç´¢ç»“æœ
            const target = el?.closest('.app-icon, .close-btn, .setting-item, .search-result');
            if (target) target.classList.add('hovered');
        }

        // ç‚¹å‡»é€»è¾‘
        function handleTap(x, y) {
            const el = document.elementFromPoint(x, y);
            if (!el) return;

            // æ‰“å¼€åº”ç”¨
            if (el.closest('#app-browser')) openWin('window-browser');
            if (el.closest('#app-settings')) openWin('window-settings');
            if (el.closest('#app-hello')) openWin('window-hello');
            
            // å…³é—­æŒ‰é’®
            if (el.closest('.close-btn')) closeAll();
            
            // æµè§ˆå™¨é‡Œçš„å‡é“¾æ¥ç‚¹å‡»æ•ˆæœ (å¯é€‰ï¼šå¯ä»¥åœ¨è¿™é‡ŒåŠ ä¸ªconsole logæˆ–è€…ç®€å•çš„è§†è§‰åé¦ˆ)
            if (el.closest('.search-result')) {
                // ä»…åšè§†è§‰åé¦ˆï¼Œä¸è·³è½¬
                const res = el.closest('.search-result');
                res.style.transform = "scale(0.98)";
                setTimeout(() => res.style.transform = "scale(1)", 150);
            }
        }

        function openWin(id) {
            const menu = document.getElementById('main-menu');
            menu.style.opacity = '0';
            menu.style.pointerEvents = 'none';
            // ç¨å¾®æ”¾å¤§ä¸€ç‚¹ï¼Œæ¨¡æ‹Ÿåº”ç”¨å¼¹å‡ºçš„æ•ˆæœ
            menu.style.transform = 'scale(1.1)'; 
            
            setTimeout(() => {
                document.getElementById(id).classList.add('open');
                menu.style.transform = 'scale(1)'; // é‡ç½®çŠ¶æ€ä¾›ä¸‹æ¬¡ä½¿ç”¨
            }, 200);
        }

        function closeAll() {
            document.querySelectorAll('.window').forEach(w => w.classList.remove('open'));
            setTimeout(() => {
                const m = document.getElementById('main-menu');
                m.style.opacity = '1'; 
                m.style.pointerEvents = 'all';
            }, 200);
        }
    </script>
</body>
</html>